# 服务器端存储功能说明

## 概述

已实现服务器端文件存储系统,支持云端保存思维导图,为后续局域网协作功能做好准备。

## 功能特性

### 1. 云端保存
- **位置**: 工具栏中的"云朵"图标按钮
- **功能**: 将当前思维导图保存到服务器(模拟云端)
- **特点**:
  - 自动更新已存在的文件
  - 保存后显示确认提示
  - 数据持久化在 localStorage 中

### 2. 云端文件管理
- **位置**: 工具栏中的"云朵"图标下拉菜单
- **功能**:
  - 查看所有云端文件列表
  - 点击文件名直接打开
  - 新建空白思维导图
  - 重命名文件
  - 删除文件
  - 刷新文件列表

### 3. 文件信息
每个云端文件包含:
- 文件ID(唯一标识)
- 文件标题
- 创建时间
- 更新时间
- 文件所有者

## 技术实现

### 当前架构(模拟阶段)
```
Frontend (React)
    ↓
Mock Server API (src/lib/server/api.ts)
    ↓
localStorage (模拟数据库)
```

### 未来架构(实际部署)
```
Frontend (React)
    ↓
Real Backend API (Node.js/Python/Rust)
    ↓
Database (PostgreSQL/MongoDB)
    ↓
Multiple Clients (局域网协作)
```

## API接口

### saveToServer(mindmap, title?)
保存思维导图到服务器

### loadFromServer(fileId)
从服务器加载思维导图

### listServerFiles()
获取用户的所有文件列表

### deleteFromServer(fileId)
删除服务器上的文件

### renameServerFile(fileId, newTitle)
重命名服务器上的文件

### createServerFile(title)
创建新的思维导图文件

## 用户隔离

系统通过 `aimind_user_id` 实现用户隔离:
- 首次访问时自动生成唯一用户ID
- 用户只能看到和操作自己的文件
- 为后续多用户协作做好准备

## 局域网协作升级路径

### 阶段1: 当前(单机模拟)
- localStorage模拟数据库
- 单用户使用
- 验证功能设计

### 阶段2: 本地服务器
- 实现真实的HTTP API
- SQLite文件数据库
- 局域网内多设备访问

### 阶段3: 协作功能
- WebSocket实时同步
- 多用户同时编辑
- 冲突解决机制
- 权限管理

### 阶段4: 云端部署
- 云服务器部署
- HTTPS加密
- 用户认证
- 跨地域协作

## 使用说明

1. **保存到云端**
   - 编辑思维导图
   - 点击工具栏的"云朵"按钮
   - 等待"已保存到服务器"提示

2. **打开云端文件**
   - 点击工具栏的"云朵"下拉图标
   - 在列表中点击要打开的文件
   - 文件自动加载到画布

3. **管理云端文件**
   - 点击"云朵"下拉图标
   - 使用右侧操作按钮:
     - ✏️ 编辑按钮: 重命名文件
     - 🗑️ 删除按钮: 删除文件
   - 点击"新建"按钮创建新文件

## 数据安全

当前版本数据存储在浏览器 localStorage 中:
- ✅ 数据持久化保存
- ✅ 浏览器关闭后不丢失
- ⚠️ 清除浏览器数据会丢失
- ⚠️ 更换浏览器/设备无法访问

建议: 定期使用"下载到本地"功能备份重要文件!

## 未来计划

- [ ] 真实的后端服务器实现
- [ ] WebSocket实时协作
- [ ] 文件版本历史
- [ ] 文件分享功能
- [ ] 权限管理(只读/编辑)
- [ ] 评论和批注
- [ ] 离线模式支持
